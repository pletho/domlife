import { DL_STATE } from './state.js'; export class SSEBridge{constructor({state,bus}){this.state=state;this.bus=bus;this.es=null}subscribe(url,{onOpen,onMessage,onError,onClose}={}){if(this.es) this.es.close();this.es=new EventSource(url);this.state.to(DL_STATE.SERVER_STREAMING,{url});this.es.onopen=(e)=>{try{onOpen?.(e)}catch{}};this.es.onmessage=(e)=>{try{onMessage?.(e)}catch{}};this.es.onerror=(e)=>{try{onError?.(e)}catch{}};const close=()=>{try{this.es?.close()}catch{};this.es=null;try{onClose?.()}catch{}};return close}}